## Kyligence Enterprise 3.4.5 Release Notes

### Release History

+ [Kyligence Enterprise 3.4.5.2115 Release Notes](#ke_3_4_5.2115)

+ [Kyligence Enterprise 3.4.5.2114 Release Notes](#ke_3_4_5.2114)

+ [Kyligence Enterprise 3.4.5.2113 Release Notes](#ke_3_4_5.2113)

+ [Kyligence Enterprise 3.4.5.2112 Release Notes](#ke_3_4_5.2112)

+ [Kyligence Enterprise 3.4.5.2111 Release Notes](#ke_3_4_5.2111)

+ [Kyligence Enterprise 3.4.5.2110 Release Notes](#ke_3_4_5.2110)

### Kyligence Enterprise 3.4.5.2115 {#ke_3_4_5.2115}

#### Enhancement

+ Support ascii, chr, space functions.

+ Enhance the log information when saving Cube to facilitate problem location.

+ Support the integration of Kyligence Enterprise 3 into the customer's cloud platform.

+ Support Gbase data source docking on FI cluster.

#### Bug Fix

+ No information is returned after the cache API is executed

+ KE query data accuracy does not match the scale

+ Failure of Calcite to parse the SQL will make it impossible to complete the schema information when the query is pushed down, and the query will fail.

+ In the same cluster, when multiple Kyligence Enterprise checks-env at the same time, some nodes will fail to check.

+ The table schema in the subquery is not completed

+ Kyligence Enterprise services can still be used when the test license expires

+ The SQL statement contains double quote, and an error will be reported when the query is pressed to SparkSQL

+ When only part of the join key between the two tables in the model is grouped in the query statement, the result of the Sparder query is incorrect.

+ An error will be constructed when the computable column contains cast (a as string) or PI

+ Fix the problem that the cast (col as string) function cannot be pushed down to Hive

+ When the In to Between function is enabled, if the SQL contains the same column name as the reserved word, the query will report an error.

### Kyligence Enterprise 3.4.5.2114 {#ke_3_4_5.2114}

#### Enhancement

+ Support FusionInsight 6.5.1

+ Add the hostname and port in submitted YARN Application job

+ Compatible with the new version of Tableau SQL syntax problem (left join-> inner join) to ensure queries can be answered by Cube

+ When JDBC dynamic parameters using in function, the query might be failed

#### Bug Fix

+ When using the default query engine and exciting multiple join keys in the join condition, the null values cannot be filtered

+ Support using HOUR unit in TIMESTAMPDIFF function

+ When using the to char function to convert decimal data, the value 0 is converted to a null character

+ Pushdown query cannot be canceled properly and no exception is returned

+ Failed to load project dictionary in parallel

+ The query id doesn't display on insight page if the query is in the deny list

+ Substring function failed to return values starting at 0 when using default query engine

+ Project dictionary might be mistakenly deleted by the routine tool

+ Support flat table as RCFILE format

+ Query might be failed if a duplicated column name exists in both main query and subquery

+ The new building job will be failed if deleted the first segment in a cube with project dictionary

### Kyligence Enterprise 3.4.5.2113 {#ke_3_4_5.2113}

#### Enhancement

+ The Spark block cleanup mechanism is introduced in this version, which improves the query stability of Kyligence Enterprise. However, because the time to clean up the block is included in the query time, it may cause a certain decrease in query performance, and the impact on small queries may be more obvious than large queries.

+ When the datatype of dimension is decimal(x,0) and its value in the query is equal to a decimal, queries which hit Cube may not get the result 

#### Bug Fix

+ The task status corresponding to asynchronous query is not synchronized between nodes in time, resulting in non-executing nodes not being able to obtain corresponding information

+ After Sum(expression) is turned on, the result of the queries which contain sum(cast(case when)) may be incorrect.

+ When there are too many requests for abnormal Spark threads, other normal tasks on the cluster may be affected

+ Spark session block size is always at a high value and has not been cleared in time. 

+ When using Sparder query engine for asynchronous query, an error may be reported when the query contains limit clause

+ The escaped single quote in the query cannot be recognized.Provide configuration kylin.query.pushdown.permissive-enabled, when it is enabled, if Calcite fails to parse the syntax, the original query will be directly issued to Spark for execution. For more details please refer to manual.

+ If the aggregate function contains multiple columns or a case when statement in the query, the query result may be incorrect

+ When there are multiple Kyligence Guardian Process processes and Kyligence Enterprise is restarted, Kyligence Enterprise may be repeatedly restarted due to the loss of another Kyligence Guardian Process token

+ An error occurred when the number type in Oracle was synchronized to Kyligence Enterprise, resulting in the failure of setting the return type of the measurement

+ When the query thread enters a long loop under certain special circumstances, the timeout query may not be stopped

+ If the subquery wraps, the query may report an error

### Kyligence Enterprise 3.4.5.2112 {#ke_3_4_5.2112}

#### Enhancement

+ Support Hive3 transaction table

+ Support project setting Kerberos to achieve project-level Hive permission isolation.

+ Materialized table supports RCFILE type

#### Bug Fix

+ When there are multiple columns in inner join condition, the query statement may not match the model.

+ SQL with commented statements cannot hit the cache

+ Modifying the computable column does not take effect

+ Using the Sparder query engine, the query containing the Month function fails

+ Unstable ZooKeeper connection will cause the build to fail

+ When calling delete Cube API, Cube and Project are inconsistent, Cube can also be deleted

+ When using the Sparder query engine to query the intersection function, an error may be reported

+ When calling the delete Cube API, the Cube can also be deleted when the Cube status is Ready

+ Kyligence Manager gets the interface error of Kyligence Enterprise task

+ The cancel button on the dimension and measure fields in the model overview is not available

+ Due to the inconsistent behavior of front-end and back-end parameters, an error is reported when the full build task is initiated on the page.

### Kyligence Enterprise 3.4.5.2111 {#ke_3_4_5.2111}

#### Enhancement

+ Provide some monitoring indicators that can be displayed in Grafana

+ Optimize the license update behavior to prevent the wrong license from being loaded into the system

+ In the return information of the query API, the number of rows of the query result is provided to improve the efficiency of statistics

+ Regularly print the number of threads of Spark Executor and jstack logs in the log to help locate possible thread-related issues.

+ Support parallel reading of dictionaries when querying. For related parameters and scope of influence

#### Bug Fix

+ After modifying the output path of logs, the log information is empty when the diagnostic package is generated

+ In the Huawei FusionInsight C80 environment, if the Spark version is 2.2.1-kylin-r13 and the starting user does not have Yarn administrator rights, error may occurred when initializing the Spark Context under certain parameter configuration

+ In the MapR platform, when running upgrade.sh file, queries may get error because spark-core.jar was not replaced correctly

+ If the version of Spark is replaced to a lower one, in the service status displayed on the web UI, when the system can execute the query that hits the Cube normally, the Spark cluster availability is still displayed as error

+ If a complex query with CONVERT function using the TIMESTAMP type is executed, the query may fail

+ When the query contains non-equal-join conditions, performance may decrease in some scenarios, so a parameter is provided which can disable such query support temporarily.

### Kyligence Enterprise 3.4.5.2110 {#ke_3_4_5.2110}

#### Enhancement

+ Support recording the usage frequency of dimension and measure in InfluxDB

+ Support encrypted connection with InfluxDB, for more details please refer to manual

+ Optimize the ability of inner join queries within left outer join model, for more details and limitation please refer to wiki page

+ Provide the Rest API documents for Model and Cube operations, for more details please refer to manual

+ Optimize the detection and cleaning ability for project dictionary when executing routine tool

+ Support using external SparkSQL to create flat table in Kingsoft Cloud.

#### Bug Fix

+ The lookup table size is not detected accurately, which may cause too much memory occupied and job node OOM if the table size is actually too large

+ In some corner cases, the merge dictionary steps may have inconsistent comparison results, which will cause the job failed with message “java.lang.IllegalStateException: Invalid input data. Unordered data cannot be split into multi trees”

+ When concurrently submit build jobs for multi-level partition cube, it may cause the metadata conflicts

+ When querying on raw data with multiple cubes, it may route to an unexpected cube and return a inaccuracy result

+ In some corner cases, if a query contains dictionary-encoded column and the local sdict file corrupted, the query fails with message “BufferUnderflowException”

+ The dictionary size is estimated inaccurately in dictionary cache policy, which may cause the memory overflow and building job failed
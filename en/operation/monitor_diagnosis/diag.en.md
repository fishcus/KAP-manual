## System and Job Diagnosis

Kyligence Enterprise users may face with many problems during usage, such as failure in creating a Cube or querying. Kyligence Enterprise provides a *Diagnosis* function on Web UI to pack related information into a zip package to help devops better analyze the root cause.
Diagnosis function including System Diagnosis and Job Diagnosis.

### Generate Diagnosis Package in Web UI
- Generate System Diagnosis Package in Web UI
  System Diagnostic Package includes all diagnostic information of a Kyligence Enterprise instance, and users can generate System Diagnosis Package on Web UI following the following steps,

  1. Click the **Diagnosis** button on **System** Page
  2. Select Time Range
     You can select *last one hour*, *last one day*, *last three days* and *last one month*, or self-defined.

     > **Note:** The selected time range must include the period of incidents.
  3. Select Package Type
     You can choose either **Basic package** or **Full package**.

     > **Note:** Basic package contains your log files, metadata and cluster information. Full package contains slow query or bad query information, etc. Uploading the basic package is highly recommended. 

  4. Select Server

     > **Note:** if Kyligence Enterprise is deployed on multiple nodes, please locate the specific node on which your issue happened by selecting the right server name, otherwise the generated system diagnostic package may not include useful information about the issue.

  5. Select method of dealing with the packages
   Kyligence Enterprise provides two options to dealing with diagnostic packages, one is downloading to local and the other is uploading to KyBot for further analysis.
     - Click **Only generate** to generate the System Diagnostic Package and download to local.
     - Click **Generate and sync package with KyBot** to generate the System Diagnostic Package or create a ticket with the package.


- Generate Job Diagnosis Package in Web UI

  Job Diagnostic Package includes all diagnostic information of a specific job, and users can generate job diagnosis package on Web UI by following the following steps:

  1. Click a certain job on the **Monitor** Page, unfold **Actions** and click **Diagnosis**.
  2. Select Server
     
     > **Note:** In the Multi-Active mode, a job may run on multiple job nodes. All the job nodes will automatically list here, you can select the nodes you need to generate package.
  3. Select method of dealing with the packages
     Kyligence Enterprise provides two options to dealing with Diagnostic Packages, one is downloading to local, and the other is uploading to KyBot for further analysis.
     - Click **Only generate** to generate the System Diagnostic Package and download to local.
     - Click **Generate and sync package with KyBot** to generate the System Diagnostic Package or create a ticket with the package.

### Generate Diagnosis Package using bash script
- Generate system diagnostics package
    Execute `$KYLIN_HOME/kybot/kybot.sh` to generate the system diagnostic package. The default time range is last 3 days.

- Generate job diagnostics package
    Execute `$KYLIN_HOME/kybot/kybot.sh -jobId <jobid>` to generate the job diagnostic package with replacing `<jobid>` with the job ID number.

- Diagnostic package storage location
    Diagnostic packages generated by scripts are stored under `$KYLIN_HOME/kybot_dump/`.

### FAQ

**Q: If I failed to generate diagnostic packages because the allocated memory is insufficient. What should I do?**

Please change the *KYBOT_JVM_SETTINGS* parameter in `$KYLIN_HOME/kybot/setenv.sh`. Then restart Kyligence Enterprise and try again.

**Q: If I failed to generate diagnostic packages because of timeout.** 

For using WEB GUI: please uncomment and change parameter `kybot.package.timeout.seconds`(in seconds) in `$KYLIN_HOME/conf/kybot-client.properties` and restart Kyligence Enterprise.

For using common line: please change the value of `timeout_threshold`(in seconds) in the file `$KYLIN_HOME/kybot/kybot.sh`. There is no need to restart Kyligence Enterprise after the change.




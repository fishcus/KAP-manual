## System Log

After being successfully started, Kyligence Enterprise will create a directory named `logs/` by default, all logs generated during Kyligence Enterprise runtime will be stored in this directory.

### Log files
Log files generated by Kyligence Enterprise is as followings,

#### `kylin.log`
This file is Kyligence Enterprise's main log file, whose default logging level is DEBUG.

#### `kylin.out`
The standard output of Kyligence Enterprise process will be redirected to this file, including the output of Tomcat and Hive.

#### `kylin.gc`
This file is the GC(Garbage Collection) log of Kyligence Enterprise Java process. And it appends pid as filename suffix to avoid being overwritten.

#### `canary.log`
This file stores the results of service status detection every 15 minutes since Kyligence Enterprise v2.5.6. Besides, the result of service status detection manually through command lines will be included in this file.

#### `check-env.out`
The standard output of executing `check-env.sh` script will be redirected to this file.

#### `check-env.error`
The error message of executing `check-env.sh` script will be redirected to this file.

#### `shell.stderr`
The result of running command lines will be stored in this file.

#### `shell.stdout`
The standard output of running command lines will be redirected to this file.

#### `cluster.info`
This file includes the information of the cluster.



### Logging Analysis
Take query as an example, submitting a query on Web UI, and we'll see the following information in `kylin.log` 


```
==========================[QUERY]===============================
SQL: select * from kylin_sales
User: ADMIN
Success: false
Duration: 3.558
Project: learn_kylin
Realization Names: [CUBE[name=kylin_sales_cube]
Cuboid Ids: [99]
Total scan count: 66
Total scan bytes: 1903
Result row count: 0
Accept Partial: true
Is Partial Result: false
Hit Exception Cache: false
Storage cache used: false
Cache type: EHCACHE
Is Query Push-Down: false
Is Prepare: false
Trace URL: null
Message: Something complex went wrong. null Please contact Kyligence Enterprise technical support for more details. 
==========================[QUERY]===============================
```

* `SQL:` The SQL statement
* `User:` The username of submitter
* `Success:` Whether this query succeeded
* `Duration:` The duration of this query, in seconds
* `Project:` The project of this query
* `Realization Names:` The Cube used for this query
* `Hit Exception Cache:` Whether this query hit cache
* `Cache type`ï¼š The cache type that query hit, which including REDIS and EHCACHE. If the query does not hit cache, the value would be null
* `Is Query Push-Down:`Whether this query is pushdown to other engines
* `Message:`Message prompted in UI page when this query finished

### Logging Configuration
Kyligence Enterprise leverages log4j for logging configuration. Users can edit `$KYLIN_HOME/conf/kylin-server-log4j.properties` to modify logging level, log files and etc.
> *Tips:* Restarting Kyligence Enterprise is necessary to make the configurations work.

#### Log path
Users can modify the path of logs in `kylin-server-log4j.properties`.
The path of `kylin.log` is controled by property `log4j.appender.file.File`, the default value is `${catalina.home}/../logs/kylin.log`, which means the logs folder under `$KYLIN_HOME`.
If users need to modify the path, it is recommended to use an absolute path. If users use a relative path, the path start point is KYLIN_HOME. The relative path may cause the log not to be obtained when exporting the diagnostic package through the command line. 
If the path contains variables, users need to set the variable as a JVM parameter in  `setenv.sh` and `setenv-tool.sh`. For example, if users want to set path as `${custom_dir}/kylin.log`, they need to edit `setenv.sh`, change
```
export KYLIN_JVM_SETTINGS="-server -Xms1g -Xmx4g ..."
```
to
```
export KYLIN_JVM_SETTINGS="-server -Dcustom_dir=/path/to/custom/dir -Xms1g -Xmx4g ..."
```
and edit `setenv-tool.sh`, change
```
export KYLIN_EXTRA_START_OPTS="-Xms1g -Xmx8g"
export KE_GUARDIAN_PROCESS_OPTS="-Xms128m -Xmx1g"
```
to
```
export KYLIN_EXTRA_START_OPTS="-Dcustom_dir=/path/to/custom/dir -Xms1g -Xmx8g"
export KE_GUARDIAN_PROCESS_OPTS="-Dcustom_dir=/path/to/custom/dir -Xms128m -Xmx1g"
```

Most other log files are also controlled by log4j, such as `canary.log` which is controled by property `log4j.appender.canary.File` . Users can customize the path as above.

#### Log output type 
Log output type can be configured in `kylin-server-log4j.properties`.
The default log output type is `org.apache.log4j.RollingFileAppender`, which means when the file size reaches a specified value, a new file is generated. The specified value can be set by `log4j.appender.file.MaxFileSize`,  which is 268435456 by default.
And if users want to generate logs by day, they can modify the parameter `log4j.appender.file` to `org.apache.log4j.DailyRollingFileAppender`.

#### Log file quantity
Log file quantity is 10 by default, which means at most 10 files can be saved, and users can set `log4j.appender.file.MaxBackupIndex` to a larger value to keep more files.
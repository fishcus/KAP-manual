## Kyligence Enterprise 3.4.5 发布声明

### 更新历史

+ [Kyligence Enterprise 3.4.5.2115 发行说明](#3.4.5.2115)

+ [Kyligence Enterprise 3.4.5.2114 发行说明](#3.4.5.2114)

+ [Kyligence Enterprise 3.4.5.2113 发行说明](#3.4.5.2113)

+ [Kyligence Enterprise 3.4.5.2112 发行说明](#3.4.5.2112)

+ [Kyligence Enterprise 3.4.5.2111 发行说明](#3.4.5.2111)

+ [Kyligence Enterprise 3.4.5.2110 发行说明](#3.4.5.2110)

### Kyligence Enterprise 3.4.5.2115 {#3.4.5.2115}
#### 优化改进

+ 支持 ascii, chr, space 函数。

+ 增强了保存Cube时的日志信息，方便问题定位。

+ 支持将Kyligence Enterprise 3集成至客户的云平台。

+ 支持对接在FI集群上的Gbase数据源。

#### 缺陷修复

+ 缓存API执行后没有返回信息

+ KE查询数据精度与scale不符

+ Calcite解析SQL失败会使得在查询下压时无法补全schema信息，从而查询失败。

+ 在同一集群中，当多个Kyligence Enterprise同时check-env时，会导致某些节点检查失败。

+ 子查询内的table schema未被补全

+ Test License 到期后 Kyligence Enterprise 服务仍可继续使用

+ SQL语句中包含双引号，查询下压到SparkSQL时会报错

+ 查询语句中仅group by了模型中两张表之间的部分join key时，使用Sparder查询结果不正确。

+ 可计算列中包含cast(a as string)或PI时会构建报错

+ 修复cast(col as string)函数无法下压至Hive的问题

+ 开启In转Between功能时，如果SQL中含包含与保留字相同的列名，查询报错。

### Kyligence Enterprise 3.4.5.2114 {#3.4.5.2114}
#### 优化改进

+ 支持 FusionInsight 6.5.1

+ YARN Application 任务中标识提交节点的名称和端口

+ 兼容新版本 Tableau 语法转化问题 (left join -> inner join) 使查询能够命中 Cube

+ JDBC 动态参数在函数中使用时，查询解析报错

#### 缺陷修复

+ 使用默认查询引擎，关联条件中有多个关联字段时，不能过滤 null 值

+ TIMESTAMPDIFF 函数支持 HOUR 为时间单位

+ 使用 to_char 函数转换 decimal 类型数据， 数值 0 被转成空字符

+ 下压查询不能正常取消，且无异常返回

+ 并行读取项目字典异常

+ 查询命中黑名单时，分析页面未显示查询 ID

+ 使用默认查询引擎时，substring 函数不支持从第0位开始取值

+ 日常运维工具可能会错误地删除项目字典文件

+ 打平表支持RCFILE格式

+ 子查询和外部查询中出现同名列时，查询可能失败

+ 删除含有项目字典的 Cube 的第一个 Segment 时，再触发构建任务时，任务失败

### Kyligence Enterprise 3.4.5.2113 {#3.4.5.2113}
#### 优化改进

+ 本次更新引入了 Spark block 清理机制，增强了 Kyligence Enterprise 的查询稳定性，但是由于在该机制下，每条查询都会增加一定清理 block 的时间，所以在查询性能上可能造成一定的下降，且对小查询的影响可能比大查询更明显一些。

+ 当维度为 decimal(x,0) 类型且其在查询中的值等于小数时，击中 Cube 可能无法得到结果

#### 缺陷修复

+ 异步查询对应的任务状态在节点之间未及时同步，导致非执行节点获取不到对应信息

+ Sum(expression) 开启后，形如 sum(cast(case when)) 的查询结果可能不正确。

+ Spark 线程异常申请过多时，可能影响集群上的其他正常任务

+ Spark session block size 一直处于很高的数值，没有被及时清理。

+ 使用 Sparder 查询引擎进行异步查询时，当查询语句中包含 limit 时可能报错

+ 查询语句中的转义单引号无法被识别。新增配置项 kylin.query.pushdown.permissive-enabled，当打开时，若 Calcite 解析语法失败，则会直接把原始查询下发到 Spark 执行。

+ 在查询语句中，如果聚合函数包含多个列或有 case when 语句，查询有可能不正确

+ 当有多个 Kyligence Guardian Process 进程且 Kyligence Enterprise 重启后，可能因为另一个 Kyligence Guardian Process 的 token 失效而导致 Kyligence Enterprise 被反复重启

+ Oracle 中的 number 类型同步到 Kyligence Enterprise 中时发生错误，导致在设置度量返回类型时报错

+ 当查询线程在某些特殊情况下进入长时间循环时，超时查询可能无法被停止

+ 子查询中如果换行，查询可能报错

### Kyligence Enterprise 3.4.5.2112 {#3.4.5.2112}
#### 优化改进

+ 支持Hive3事务表

+ 支持项目设置 Kerberos，实现项目级 Hive 权限隔离

+ 物化表支持RCFILE类型

#### 缺陷修复
+ 当inner join的关联条件中存在多列时，查询语句可能匹配不到模型。

+ 带有注释语句的SQL无法击中缓存

+ 修改可计算列不生效

+ 使用 Sparder 查询引擎，包含 Month 函数的查询失败

+ ZooKeeper连接不稳定会导致构建无法重试成功

+ 调用删除 Cube API 时，Cube 与 Project 不一致，Cube 也能被删除

+ 使用Sparder查询引擎在查询交集函数时可能会报错

+ 调用删除 Cube API 时，当 Cube 状态为 Ready 时，Cube 也能被删除

+ Kyligence Manager 获取Kyligence Enterprise 任务的接口报错

+ 模型概览中的维度和度量字段上的取消按钮不可用

+ 因前后端参数行为不统一，导致的页面上发起全量构建任务时报错

### Kyligence Enterprise 3.4.5.2111 {#3.4.5.2111}
#### 优化改进

+ 提供一些可以在 Grafana 中展示的监控指标

+ 优化许可证更新行为，防止错误的许可证被载入系统

+ 在查询 API 的返回信息中，增加查询结果的行数，提升客户统计效率

+ 在日志中定时打印 Spark Executor 的线程数和 jstack 日志，帮助定位可能的线程相关问题

+ 支持查询时并行读取项目字典

#### 缺陷修复

+ 修改日志的输出路径后，生成诊断包时日志信息为空

+ 华为 FusionInsight C80 环境下，如果 Spark 版本为 2.2.1-kylin-r13，且启动用户的角色中没有 Yarn 的管理员权限，在特定参数配置下，初始化 Spark Context 有可能报错

+ 在 MapR 平台中，启动升级脚本时，由于未替换 spark-core.jar 导致查询报错

+ 如果将 Spark 替换为低版本，在界面展示的服务状态中，当系统可正常执行击中 Cube 的查询时，Spark 集群可用性仍展示为错误

+ 如果执行复杂查询，且查询中 CONVERT 函数使用了 TIMESTAMP 类型，查询可能执行失败

+ 查询中包含非等号 join 条件时，在部分场景下可能出现性能下降，提供参数支持暂时关闭此类查询支持

### Kyligence Enterprise 3.4.5.2110 {#3.4.5.2110}
#### 优化改进

+ 支持在 InfluxDB 中记录 Cube 维度和度量使用频率

+ 支持 InfluxDB 连接密码加密配置，更多信息请参考手册

+ 优化 Left Outer Join 模型中对 Inner Join 查询的支持，使用说明及已知限制请参考 wiki 文档

+ 提供模型和 Cube 创建等操作相关 Rest API 文档，更多信息请参考手册

+ 优化垃圾清理工具，增强对于项目字典的检测和清理力度

+ 支持金山云环境下使用外部 SparkSQL 打平表

#### 缺陷修复

+ 维表大小的检测不准，导致维表实际大小过大时占用太多内存导致构建节点 OOM

+ 偶发情况下，构建的合并字典步骤因为比较逻辑异常，导致报错“java.lang.IllegalStateException: Invalid input data. Unordered data cannot be split into multi trees”

+ 并发提交多级分区 Cube 构建任务可能发生元数据写入冲突

+ 明细查询需要多个 Cube 回答时，可能路由至错误的 Cube 回答导致查询结果不准确

+ 偶发情况下，查询使用字典编码的列且本地 sdict 文件损坏时，查询失败报错“BufferUnderflowException”

+ 字典缓存更新策略可能没有正确计算字典大小，从而造成内存溢出并导致构建任务失败以及节点稳定性